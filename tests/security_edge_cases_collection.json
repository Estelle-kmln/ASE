{
	"info": {
		"name": "Battle Cards - Security & Edge Cases Tests",
		"description": "Comprehensive security, malformed request, authorization, rate limiting, concurrency, and large input tests for Battle Cards API",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. Malformed Requests",
			"item": [
				{
					"name": "Bad JSON - Invalid Syntax",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"pm.test('Response contains error about JSON', function () {",
									"    var response = pm.response.text();",
									"    pm.expect(response.toLowerCase()).to.include('json');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"username\": \"test\", \"password\": \"test123\" missing_comma \"extra\": \"field\" }"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				},
				{
					"name": "Wrong Content-Type - Form Data as JSON",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400 or 415', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([400, 415]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "username=testuser&password=testpass123"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				},
				{
					"name": "SQL Injection in Username",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400 (not 500)', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"pm.test('No SQL error leaked', function () {",
									"    var response = pm.response.text();",
									"    pm.expect(response.toLowerCase()).to.not.include('sql');",
									"    pm.expect(response.toLowerCase()).to.not.include('postgres');",
									"    pm.expect(response.toLowerCase()).to.not.include('database');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"admin'; DROP TABLE users; --\",\n    \"password\": \"test123\"\n}"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				},
				{
					"name": "XSS Injection in Username",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"pm.test('XSS payload not reflected', function () {",
									"    var response = pm.response.text();",
									"    pm.expect(response).to.not.include('<script>');",
									"    pm.expect(response).to.not.include('alert(');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"<script>alert('XSS')</script>\",\n    \"password\": \"test123\"\n}"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				},
				{
					"name": "Extra Unexpected Fields",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400 or ignores extra fields', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([201, 400]);",
									"});",
									"pm.test('Extra fields handled properly', function () {",
									"    if (pm.response.code === 201) {",
									"        var jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.not.have.property('admin');",
									"        pm.expect(jsonData).to.not.have.property('role');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"testuser{{$randomInt}}\",\n    \"password\": \"test123\",\n    \"admin\": true,\n    \"role\": \"superuser\",\n    \"injection\": \"../../../etc/passwd\",\n    \"__proto__\": {\"isAdmin\": true}\n}"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				}
			]
		},
		{
			"name": "2. Authorization Logic",
			"item": [
				{
					"name": "Setup - Register User A",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('User A registered', function () {",
									"    pm.response.to.have.status(201);",
									"    var jsonData = pm.response.json();",
									"    pm.globals.set('userA_token', jsonData.access_token);",
									"    pm.globals.set('userA_username', 'usera' + pm.globals.get('timestamp'));",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.globals.set('timestamp', Date.now());"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"usera{{timestamp}}\",\n    \"password\": \"test123\"\n}"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				},
				{
					"name": "Setup - Register User B",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('User B registered', function () {",
									"    pm.response.to.have.status(201);",
									"    var jsonData = pm.response.json();",
									"    pm.globals.set('userB_token', jsonData.access_token);",
									"    pm.globals.set('userB_username', 'userb' + pm.globals.get('timestamp'));",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"userb{{timestamp}}\",\n    \"password\": \"test123\"\n}"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				},
				{
					"name": "User A Creates Game",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Game created by User A', function () {",
									"    pm.response.to.have.status(201);",
									"    var jsonData = pm.response.json();",
									"    pm.globals.set('userA_game_id', jsonData.game_id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{userA_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"player2_name\": \"opponent123\"\n}"
						},
						"url": "http://localhost:5003/api/games"
					}
				},
				{
					"name": "User B Tries to Access User A's Game - SHOULD FAIL",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 403 or 404 (unauthorized)', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([403, 404]);",
									"});",
									"pm.test('User B cannot access User A game', function () {",
									"    pm.expect(pm.response.code).to.not.equal(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{userB_token}}"
							}
						],
						"url": "http://localhost:5003/api/games/{{userA_game_id}}"
					}
				},
				{
					"name": "User B Tries to Play Card in User A's Game - SHOULD FAIL",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 403 or 404 (unauthorized)', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([403, 404]);",
									"});",
									"pm.test('User B cannot play in User A game', function () {",
									"    pm.expect(pm.response.code).to.not.equal(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{userB_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"card_index\": 0\n}"
						},
						"url": "http://localhost:5003/api/games/{{userA_game_id}}/play"
					}
				},
				{
					"name": "Invalid Token Format - SHOULD FAIL",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 401 or 422', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([401, 422]);",
									"});",
									"pm.test('Invalid token rejected', function () {",
									"    var response = pm.response.text();",
									"    pm.expect(response.toLowerCase()).to.include('token');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer invalid.jwt.token.format"
							}
						],
						"url": "http://localhost:5002/api/cards"
					}
				}
			]
		},
		{
			"name": "3. Rate Limiting Tests",
			"item": [
				{
					"name": "Rapid Login Attempts - Attempt 1",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('First login attempt', function () {",
									"    // Should succeed or fail normally, not rate limited",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 401]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"nonexistent\",\n    \"password\": \"wrongpass\"\n}"
						},
						"url": "http://localhost:5001/api/auth/login"
					}
				},
				{
					"name": "Rapid Login Attempts - Attempt 2",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"nonexistent\",\n    \"password\": \"wrongpass\"\n}"
						},
						"url": "http://localhost:5001/api/auth/login"
					}
				},
				{
					"name": "Rapid Login Attempts - Attempt 3",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"nonexistent\",\n    \"password\": \"wrongpass\"\n}"
						},
						"url": "http://localhost:5001/api/auth/login"
					}
				},
				{
					"name": "Rapid Login Attempts - Check Rate Limiting",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Rate limiting should kick in', function () {",
									"    // Should be rate limited (429) or still allow (401)",
									"    // This tests if rate limiting is implemented",
									"    pm.expect(pm.response.code).to.be.oneOf([401, 429]);",
									"    if (pm.response.code === 429) {",
									"        console.log('‚úÖ Rate limiting is working!');",
									"    } else {",
									"        console.log('‚ö†Ô∏è  Rate limiting might not be implemented');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"nonexistent\",\n    \"password\": \"wrongpass\"\n}"
						},
						"url": "http://localhost:5001/api/auth/login"
					}
				},
				{
					"name": "Rapid Game Creation Test",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Game creation rate limiting', function () {",
									"    // Should succeed, fail normally, or be rate limited",
									"    pm.expect(pm.response.code).to.be.oneOf([201, 400, 429]);",
									"    if (pm.response.code === 429) {",
									"        console.log('‚úÖ Game creation rate limiting works!');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{userA_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"player2_name\": \"rapidtest{{$randomInt}}\"\n}"
						},
						"url": "http://localhost:5003/api/games"
					}
				}
			]
		},
		{
			"name": "4. Large Input Tests",
			"item": [
				{
					"name": "Very Long Username",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400 (not 500)', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"pm.test('Error handled gracefully', function () {",
									"    var response = pm.response.text();",
									"    pm.expect(response.toLowerCase()).to.include('username');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"a\".repeat(10000),\n    \"password\": \"test123\"\n}"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				},
				{
					"name": "Very Long Password",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400 (not 500)', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"pm.test('Error handled gracefully', function () {",
									"    var response = pm.response.text();",
									"    pm.expect(response.toLowerCase()).to.include('password');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"testuser123\",\n    \"password\": \"p\".repeat(10000)\n}"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				},
				{
					"name": "Very Large JSON Body",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400 or 413 (not 500)', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([400, 413]);",
									"});",
									"pm.test('Large payload rejected gracefully', function () {",
									"    var response = pm.response.text();",
									"    pm.expect(response).to.not.include('Internal Server Error');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"testuser123\",\n    \"password\": \"test123\",\n    \"large_field\": \"x\".repeat(1000000)\n}"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				},
				{
					"name": "Very Large Card ID",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 404 or 400 (not 500)', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([400, 404]);",
									"});",
									"pm.test('Large ID handled gracefully', function () {",
									"    var response = pm.response.text();",
									"    pm.expect(response).to.not.include('Internal Server Error');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{userA_token}}"
							}
						],
						"url": "http://localhost:5002/api/cards/999999999999999999999999999999"
					}
				}
			]
		},
		{
			"name": "5. Special Characters & Encoding",
			"item": [
				{
					"name": "Unicode Characters in Username",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Unicode handled properly', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([201, 400]);",
									"});",
									"pm.test('No encoding errors', function () {",
									"    var response = pm.response.text();",
									"    pm.expect(response).to.not.include('encoding');",
									"    pm.expect(response).to.not.include('unicode');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"Áî®Êà∑ÂêçüéÆüÉè\",\n    \"password\": \"test123\"\n}"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				},
				{
					"name": "Null Bytes in Input",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Null bytes handled safely', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"pm.test('No null byte injection', function () {",
									"    var response = pm.response.text();",
									"    pm.expect(response).to.not.include('\\\\x00');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"test\\u0000user\",\n    \"password\": \"test123\"\n}"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				}
			]
		},
		{
			"name": "6. HTTP Method Security",
			"item": [
				{
					"name": "OPTIONS Request - Check CORS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('OPTIONS handled properly', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 204, 405]);",
									"});",
									"pm.test('CORS headers present', function () {",
									"    if (pm.response.code === 200 || pm.response.code === 204) {",
									"        pm.expect(pm.response.headers.get('Access-Control-Allow-Origin')).to.exist;",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "OPTIONS",
						"header": [],
						"url": "http://localhost:5001/api/auth/login"
					}
				},
				{
					"name": "HEAD Request Test",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('HEAD handled properly', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 405]);",
									"});",
									"pm.test('No response body in HEAD', function () {",
									"    if (pm.response.code === 200) {",
									"        pm.expect(pm.response.text()).to.equal('');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "HEAD",
						"header": [],
						"url": "http://localhost:5001/health"
					}
				},
				{
					"name": "PUT on POST Endpoint - Should Fail",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('PUT rejected on POST endpoint', function () {",
									"    pm.response.to.have.status(405);",
									"});",
									"pm.test('Method not allowed', function () {",
									"    var response = pm.response.text();",
									"    pm.expect(response.toLowerCase()).to.include('method');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"testuser\",\n    \"password\": \"test123\"\n}"
						},
						"url": "http://localhost:5001/api/auth/register"
					}
				}
			]
		}
	]
}