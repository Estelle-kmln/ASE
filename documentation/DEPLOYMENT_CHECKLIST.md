# ðŸš€ Battlecards Deployment Checklist

## Pre-Deployment Verification

### âœ… Frontend Files
- [x] login.html
- [x] index.html (homepage)
- [x] deck-selection.html
- [x] game.html
- [x] profile.html
- [x] game-history.html
- [x] statistics.html
- [x] rules.html
- [x] admin.html (admin panel)
- [x] welcome.html
- [x] css/styles.css
- [x] js/auth.js (with token refresh)
- [x] js/token-management.js (token refresh module)
- [x] js/home.js
- [x] js/deck-selection.js
- [x] js/game.js (with countdown timer)
- [x] js/profile.js
- [x] js/game-history.js
- [x] js/admin.js (log viewing)

### âœ… Configuration Files
- [x] docker-compose.yml (all 5 microservices + nginx + postgresql)
- [x] nginx/nginx.conf (HTTPS/TLS configuration, frontend serving, API routing)
- [x] nginx/ssl/localhost.crt (self-signed SSL certificate)
- [x] nginx/ssl/localhost.key (SSL private key)
- [x] .env (GAME_HISTORY_KEY - auto-generated by build script)
- [x] Database initialization scripts (06-add-account-lockout.sql, 07-add-sessions.sql, 08-add-refresh-tokens.sql, 09-add-user-logs.sql)

### âœ… Documentation
- [x] README.md (main project README with all features)
- [x] frontend/README.md
- [x] frontend/IMPLEMENTATION.md
- [x] microservices/README.md
- [x] documentation/QUICK_START.md
- [x] documentation/API_Documentation.md
- [x] documentation/SECURITY_GUIDE.md
- [x] documentation/TOKEN_REFRESH_QUICK_REFERENCE.md
- [x] documentation/CONCURRENT_SESSION_QUICK_REFERENCE.md
- [x] documentation/ACCOUNT_LOCKOUT_SUMMARY.md
- [x] documentation/LOGGING_QUICK_REFERENCE.md
- [x] documentation/DECK_SELECTION_FEATURE.md
- [x] documentation/COUNTDOWN_TIMER_FEATURE.md
- [x] documentation/GAME_INVITATION_UPDATE.md

## Deployment Steps

### 1. Stop Existing Containers
```powershell
cd microservices
docker compose down
```

### 2. Rebuild with New Configuration
```powershell
docker compose up -d --build
```

### 3. Verify Services
```powershell
docker compose ps
```

Expected output - all services should be "Up" and "healthy":
- postgresql
- auth-service
- card-service
- game-service
- leaderboard-service
- api-gateway

### 4. Check Logs
```powershell
# Check nginx gateway logs
docker compose logs api-gateway

# Should see: "Configuration complete; ready for start up"
```

### 5. Test Frontend Access
Open browser to: `https://localhost:8443`

Expected:
- Browser shows security warning (self-signed certificate)
- Click "Advanced" > "Proceed to localhost"
- Login page loads with Battlecards styling
- HTTP requests to `http://localhost:8080` automatically redirect to HTTPS

### 6. Verify HTTPS Configuration
```powershell
# Test HTTPS endpoint
curl -k https://localhost:8443/health

# Verify HTTP redirect
curl -I http://localhost:8080/health
# Should return 301 redirect to https://localhost:8443
```

## Security Testing

### HTTPS/TLS
- [ ] All HTTP requests redirect to HTTPS
- [ ] SSL certificate warning appears (expected for self-signed)
- [ ] Connection shows as secure after accepting certificate
- [ ] All API calls use HTTPS

### Token Refresh
- [ ] Access token expires after 24 hours
- [ ] Refresh token automatically renews access token
- [ ] No re-authentication required during refresh
- [ ] Expired refresh token requires re-login

### Account Security
- [ ] 3 failed logins lock account for 15 minutes
- [ ] Lockout countdown displays correctly
- [ ] Successful login resets failed attempt counter
- [ ] Locked accounts cannot login even with correct password

### Session Control
- [ ] Only one session per user (strict mode)
- [ ] Second login attempt rejected with clear message
- [ ] Logout from one device ends that session
- [ ] Session persistence across page refreshes

### Action Logging
- [ ] All user actions logged (login, game creation, etc.)
- [ ] Failed login attempts logged with IP address
- [ ] Admin can view all logs
- [ ] Non-admin users cannot access logs
- [ ] Logs include timestamp, username, action, details

## Testing Checklist

### Authentication Flow
- [ ] Register new user (strong password required)
- [ ] Logout
- [ ] Login with created user
- [ ] Test failed login attempts (should lock after 3 attempts)
- [ ] Verify account lockout message and countdown
- [ ] Wait for lockout to expire or test successful login resets counter
- [ ] Redirected to homepage after login
- [ ] Token automatically refreshes when expired
- [ ] Test concurrent session control (login from "different device" gets rejected)

### Homepage
- [ ] "Battlecards!" header visible
- [ ] Menu button (â˜°) works
- [ ] Dropdown menu shows username
- [ ] Two large game buttons visible
- [ ] "LAUNCH A GAME!" button works
- [ ] Modal shows game code
- [ ] "JOIN A GAME!" button works
- [ ] Join modal accepts code input

### Game Invitations
- [ ] Launch game sends invitation to specified player
- [ ] Invitation code is generated and displayed
- [ ] Invited player receives notification
- [ ] Accept invitation button works
- [ ] Decline invitation button works
- [ ] Cancel invitation button works (for creator)
- [ ] View pending invitations

### Deck Selection
- [ ] Back button visible
- [ ] Manual/Random toggle works
- [ ] +/- buttons work for card selection
- [ ] Total card count updates to 22 cards
- [ ] Cannot exceed 22 cards
- [ ] Confirm button enables when 22 cards selected
- [ ] Random deck generates 22 cards automatically
- [ ] Both players must confirm decks before game starts

### Game Play
- [ ] Quit button visible
- [ ] Player names and scores display
- [ ] Turn number shows
- [ ] Countdown timer displays and updates in real-time
- [ ] Cards can be selected and played
- [ ] Round resolution shows winner
- [ ] Score updates correctly based on card power
- [ ] Game ends when decks are exhausted
- [ ] Victory/defeat popup appears with final scores

### Session Management
- [ ] View active sessions in profile
- [ ] Session shows device info, IP address, timestamps
- [ ] Logout from specific device works
- [ ] Logout from all devices works
- [ ] New login invalidates old session (strict mode)

### Admin Panel (admin user only)
- [ ] Admin panel accessible from menu
- [ ] View all user logs
- [ ] Search logs by username
- [ ] Filter logs by action type
- [ ] Filter logs by date range
- [ ] Pagination works correctly
- [ ] Log details show username, action, timestamp, IP address
- [ ] Non-admin users cannot access admin panel
- [ ] Hand displays cards with emojis
- [ ] Can select cards
- [ ] Play button enables when card selected
- [ ] Cards play and reveal
- [ ] Scores update after each round
- [ ] Game over modal appears at end

### Victory/Defeat
- [ ] Victory shows gold crown ðŸ‘‘
- [ ] Defeat shows grey skull ðŸ’€
- [ ] Final score displays
- [ ] Return to home button works

### Profile
- [ ] Back button works
- [ ] Profile data loads
- [ ] Edit button enables fields
- [ ] Cancel button reverts changes
- [ ] Save button updates profile
- [ ] Password validation works

### Leaderboard
- [ ] Back button works
- [ ] Match history loads
- [ ] Table displays correctly
- [ ] Pagination works
- [ ] Win/Loss colored correctly

### Menu Navigation
- [ ] Profile link works
- [ ] Leaderboard link works
- [ ] Statistics link works
- [ ] Rules link works
- [ ] Logout works

## API Connectivity Tests

### Test Auth Endpoints
```powershell
# Register
curl -X POST http://localhost:8080/api/auth/register `
  -H "Content-Type: application/json" `
  -d '{\"username\":\"test\",\"password\":\"test123\"}'

# Login
curl -X POST http://localhost:8080/api/auth/login `
  -H "Content-Type: application/json" `
  -d '{\"username\":\"test\",\"password\":\"test123\"}'
```

### Test Game Endpoints
```powershell
# Create game (use token from login)
curl -X POST http://localhost:8080/api/game/create `
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

## Common Issues & Solutions

### Issue: Cannot access http://localhost:8080
**Solution:**
```powershell
# Check if api-gateway is running
docker compose ps api-gateway

# View logs
docker compose logs api-gateway

# Restart if needed
docker compose restart api-gateway
```

### Issue: CSS/JS not loading
**Solution:**
```powershell
# Verify volume mount
docker compose config | Select-String "frontend"

# Should see: ../frontend:/usr/share/nginx/html:ro

# Force browser refresh: Ctrl+F5
```

### Issue: API calls failing (CORS errors)
**Solution:**
```powershell
# Check nginx config
docker compose exec api-gateway cat /etc/nginx/nginx.conf

# Verify CORS headers are present
# Restart nginx
docker compose restart api-gateway
```

### Issue: Login not working
**Solution:**
```powershell
# Check auth-service logs
docker compose logs auth-service

# Verify database connection
docker compose logs postgresql
```

### Issue: Game creation/joining fails
**Solution:**
```powershell
# Check game-service logs
docker compose logs game-service

# Verify card-service is healthy
docker compose ps card-service
```

## Performance Checks

### Check Response Times
- [ ] Login < 1 second
- [ ] Homepage load < 500ms
- [ ] Game creation < 1 second
- [ ] Card play < 500ms

### Check Polling Intervals
- [ ] Game status polling: 2-3 seconds
- [ ] Game state polling: 3 seconds
- [ ] No excessive API calls

## Security Checks

- [ ] JWT tokens required for protected routes
- [ ] Passwords not visible in network tab
- [ ] HTTPS redirect working (if SSL enabled)
- [ ] No sensitive data in localStorage (only token)
- [ ] CORS headers properly configured

## Browser Compatibility

Test in:
- [ ] Chrome/Edge (Chromium)
- [ ] Firefox
- [ ] Safari (if available)
- [ ] Mobile browsers

## Mobile Responsiveness

Test on mobile viewport:
- [ ] Login page readable
- [ ] Buttons tap-friendly
- [ ] Game cards selectable
- [ ] Tables scroll horizontally
- [ ] Menu accessible

## Final Sign-Off

- [ ] All services healthy
- [ ] Frontend loads correctly
- [ ] Can create account
- [ ] Can login
- [ ] Can launch game
- [ ] Can join game
- [ ] Can select deck
- [ ] Can play game
- [ ] Can view profile
- [ ] Can view leaderboard
- [ ] All navigation works
- [ ] No console errors
- [ ] Documentation complete

## Rollback Plan

If issues occur:
```powershell
# Stop all services
docker compose down

# Restore previous version (if needed)
git checkout <previous-commit>

# Restart
docker compose up -d
```

## Post-Deployment

### Monitor Logs
```powershell
# Watch all logs
docker compose logs -f

# Watch specific service
docker compose logs -f api-gateway
docker compose logs -f auth-service
docker compose logs -f game-service
```

### Database Backup
```powershell
# Backup database
docker compose exec postgresql pg_dump -U gameuser battlecards > backup.sql
```

## Success Criteria

âœ… Application accessible at http://localhost:8080
âœ… Users can register and login
âœ… Users can create and join games
âœ… Gameplay works end-to-end
âœ… No critical errors in logs
âœ… All pages accessible
âœ… All navigation functional
âœ… Responsive on mobile
âœ… Documentation complete

---

**Deployment Date:** _________________
**Deployed By:** _________________
**Status:** â¬œ Success  â¬œ Issues  â¬œ Rollback

**Notes:**
_______________________________________
_______________________________________
_______________________________________
